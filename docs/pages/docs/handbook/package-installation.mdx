import Callout from "../../../components/Callout";
import HeartIcon from "@heroicons/react/solid/HeartIcon";
import { Tabs, Tab } from "../../../components/Tabs";

# Package Installation

A package manager (like `npm`) handles two things for you: installing packages and [managing workspaces](/docs/handbook/workspaces).

Turborepo is compatible with three package managers:

- [npm](https://docs.npmjs.com/cli/v8/using-npm/workspaces#description)
- [Yarn 1](https://classic.yarnpkg.com/lang/en/docs/workspaces/)
- [pnpm](https://pnpm.io/workspaces)

## Installing packages

When you first clone or create your monorepo, you'll need to:

1. Make sure you're in the root directory of your monorepo
2. Run the install command:

<Tabs items={['npm', 'yarn', 'pnpm']} storageKey="selected-pkg-manager">
  <Tab>
    ```bash
    npm install
    ```
  </Tab>
  <Tab>
    ```bash
    yarn install
    ```
  </Tab>
  <Tab>
    ```bash
    pnpm install
    ```
  </Tab>
</Tabs>

You'll now see `node_modules` folders appear in the root of your repository, and in each workspace.

<Callout>
  Ensure that you've got your [workspaces](/docs/handbook/workspaces) set up correctly. If you ran `npx create-turbo` this will already be handled for you.
</Callout>

## Adding/removing/upgrading packages

You can add, remove and upgrade packages from within your monorepo using your package manager's built-in commands:

<Tabs items={['npm', 'yarn', 'pnpm']} storageKey="selected-pkg-manager">
  <Tab>

    **Install a package in a workspace**
    ```bash
    npm install <package> -w=<workspace>
    ```

    Example:
    ```bash
    npm install react -w=web
    ```

    **Remove a package from a workspace**
    ```bash
    npm uninstall <package> -w=<workspace>
    ```

    Example:
    ```bash
    npm uninstall react -w=web
    ```

    **Upgrade a package in a workspace**
    ```bash
    npm update <package> -w=<workspace>
    ```

    Example:
    ```bash
    npm update react -w=web
    ```

  </Tab>
  <Tab>

    **Install a package in a workspace**
    ```bash
    yarn workspace <workspace> add <package>
    ```

    Example:
    ```bash
    yarn workspace web add react
    ```

    **Remove a package from a workspace**
    ```bash
    yarn workspace <workspace> remove <package>
    ```

    Example:
    ```bash
    yarn workspace web remove react
    ```

    **Upgrade a package in a workspace**
    ```bash
    yarn workspace <workspace> upgrade <package>
    ```

    Example:
    ```bash
    yarn workspace web upgrade react
    ```

  </Tab>
  <Tab>

    **Install a package in a workspace**
    ```bash
    pnpm add <package> --filter <workspace>
    ```

    Example:
    ```bash
    pnpm add react --filter web
    ```

    **Remove a package from a workspace**
     ```bash
    pnpm uninstall <package> --filter <workspace>
    ```

    Example:
    ```bash
    pnpm uninstall react --filter web
    ```

    **Upgrade a package in a workspace**
     ```bash
    pnpm up <package> --filter <workspace>
    ```

    Example:
    ```bash
    pnpm up react --filter web
    ```

  </Tab>
</Tabs>

## Handling mis-matched package versions

As your monorepo grows, you may end up with different versions of packages in different workspaces.

For instance, `app` may use `react@18.0.0`, but `web` may use `react@17.0.0`. This is especially true when you've just [migrated from a multi-repo setup](/docs/handbook/migrating-to-a-monorepo).

Mis-matched dependencies in different repositories can mean that code runs unexpectedly. React, for instance, will error if there is more than one version installed.

#### `@manypkg/cli`

Our recommended method for handling this problem is with [`@manypkg/cli`](https://www.npmjs.com/package/@manypkg/cli) - a CLI which can ensure that your dependencies match across your repositories.

Here's a quick example. At the root of your `package.json`, add a `postinstall` script.

```json filename="package.json"
{
  "scripts": {
    // This will check your dependencies match
    // after each installation
    "postinstall": "manypkg check"
  },
  "dependencies": {
    // Make sure you install @manypkg/cli
    "@manypkg/cli": "latest"
  }
}
```

You can also run `manypkg fix` to automatically update them throughout your repository.
